var app,to=null;console.log=console.log||function(){};var get=window.get||{},api=window.api||{item:{}};Aim.client=Aim.client||{};Aim.appScript=get.script||Aim.appScript||'';Aim.client.app='aliconnector';api.item[Aim.deviceID]={};setchecksrvdata=function(tmsec){if(to)clearTimeout(to);to=setTimeout(checksrvdata,tmsec);}printurldone=function(par){}checksrvdata=function(){setchecksrvdata(5000);Aim.load({src:'https://aliconnect.nl/aim/'+Aim.version+'/api/aliconnector/checksrvdata',onload:function(){var d=new Date();var d=(new Date(d.getTime()-d.getTimezoneOffset()*60*1000)).toISOString().replace(/[T|Z]/g, ' ').split('.').shift();elCheckServerData.innerHTML='Data ontvangen '+d+this.responseText;if(this.data&&this.data.printjob){elCheckServerData.innerHTML+='<br>Printing '+(this.data.printjob.documentname||this.data.printjob.aid);try{external.printurl('https://aliconnect.nl/aim/'+Aim.version+'/api/aliconnector/printjob/'+this.data.printjob.aid);}catch(err){elCheckServerData.innerHTML+='<br>Error:'+err.message;}setchecksrvdata(5000);}}});}editfiledone=function(url){url=url.split('/').pop();Aim.messenger.send({msg:{editfiledone:url}});}focusapp=function(){document.body.focus();}activitytracker=function(){if(aliconnector.toActivitytracker)clearTimeout(aliconnector.toActivitytracker);if(aliconnector.state !='focus'){Aim.wss.send({msg:{state:aliconnector.state='focus',ip:aliconnect.location.ip}});}aliconnector.toActivitytracker=setTimeout(function(){Aim.wss.send({msg:{state:aliconnector.state='online',ip:aliconnect.location.ip}});},5000);}Aim.add(aliconnector={on:{load:function(){if(Aim.scripts.length){document.head.appendTag('script',{type:"text/javascript",charset:"UTF-8",src:Aim.scripts.shift(),onload:arguments.callee.bind(this)});return;}with(document.body){elName=appendTag('div',{innerText:''});body=appendTag('div',{className:'aco oa pages'});menubtns=appendTag('div',{className:'row menubtns'});}if(get&&get.username){window.addEventListener('blur',function(){setTimeout(function(){external.hide();},100);});}aliconnector.show();Aim.messenger.to={deviceUID:Aim.deviceUID};},},messenger:{onreceive:function(event){var data=this.data;if(data.device&&confirm('Link connector to active browser?')){Aim.elDeviceID.value=data.device.uid;Aim.elFormSettings.submit();}if(data.state&&data.from.app=='om'&&data.from.device==Aim.client.device.id){if(data.state=='disconnected'){document.body.style.color='red';}if(data.state=='connected'){document.body.style.color='green';if(!data.ack)Aim.messenger.send({to:{client:data.from.client},state:'connected',ack:1});}}if(this.data.alert)alert(this.data.alert);return;if(msg){if(data.client.app=='app'&&data.client.deviceUID==Aim.messenger.sender.deviceUID){if(msg.state=='connected')Aim.messenger.send({to:{deviceUID:Aim.messenger.sender.deviceUID},msg:{state:aliconnector.state='connected',ack:true}});if(msg.userName){elName.innerText=msg.userName;activitytracker();}if(msg.userUID){Aim.messenger.sender.userUID=msg.userUID}return;}if(data.target=='rci'&&data.id&&data.values&&window.opc&&api.items[data.id]&&api.items[data.id].values)for(var name in data.values){if(api.items[data.id].values[name]&&api.items[data.id].values[name].opcItemID){external.opcSet(api.items[data.id].values[name].opcItemID,data.values[name]);}}if(msg.editfile)try{external.filedownload(msg.editfile);}catch(err){if(elStatus)elStatus.innerText='Error:'+err.message;}if(msg.deviceUID==Aim.deviceUID||(msg.appUID&&Aim.appUID&&(msg.appUID==Aim.appUID))){if(msg.printurl){elStatus.innerText=msg.printurl;try{external.printurl(msg.printurl);}catch(err){if(elStatus)elStatus.innerText='Error:'+err.message;}}}if(msg.deviceUID&&Aim.deviceUID&&msg.deviceUID==Aim.deviceUID){if(msg.exec=='mailimport')external.mailimport(App.sessionID,msg.hostID,msg.userID);if(msg.exec=='contactimport')external.contactimport(App.sessionID,msg.hostID,msg.userID);if(msg.EditFile)external.EditFile(msg.fileId,msg.userID,msg.filename,msg.uid,msg.ext,msg.edituid);}}},},elStatus:elStatus={},panels:panels={admin:{title:'Alle instellingen',init:function(){with(this.el){elStatus=elCheckServerData=appendTag('div',{innerText:'STATUS'});with(Aim.elFormSettings=appendTag('div').appendTag('form',{method:'post',action:'/api/'+Aim.version+'/index.php?redirect_uri='+encodeURIComponent(document.location.href),className:'init'})){appendTag('label',{innerText:'Login'});var labels={IP:aliconnect.location.ip}if(aliconnect.location.ref&&aliconnect.location.ref.get)Object.assign(labels,{Userdomain:aliconnect.location.ref.get.userdomain,Username:aliconnect.location.ref.get.username,Computername:aliconnect.location.ref.get.computername,Serial:aliconnect.location.ref.get.serial});for(var name in labels)if(labels[name])appendTag('div',{className:'label',innerText:name}).appendTag('div').appendTag('input',{attr:{value:labels[name]||'',readonly:true}});Aim.elDeviceID=appendTag('div',{className:'label',innerText:'Device'}).appendTag('div').appendTag('input',{attr:{name:'deviceUID',placeholder:'Device',value:Aim.device.uid}});appendTag('div',{className:'label',innerText:'Key'}).appendTag('div').appendTag('input',{attr:{name:'key',placeholder:'Key',value:Aim.key||''}});appendTag('div',{className:'label',innerText:'Script'}).appendTag('div').appendTag('input',{attr:{name:'appScript',placeholder:'Script',value:Aim.appScript}});appendTag('button',{innerText:'Opslaan'});}appendTag('button',{innerText:'Logout',onclick:function(){document.location.href='/aim/'+Aim.version+'/api/auth/logout?redirect_uri='+document.location.href;}});}checksrvdata();}}},show:function(){with(menubtns){console.log(aliconnector.panels);for(var name in Aim.panels){var pnl=Aim.panels[name];pnl.name=name;pnl.el=body.appendTag('div',{className:'panel'});pnl.elTitle=pnl.el.appendTag('label',{innerText:pnl.title});pnl.btn=appendTag('button',{pnl:pnl,onclick:pnl.show=function(){for(var name in Aim.panels)Aim.panels[name].el.style.display='none';this.pnl.el.style.display='';}}).appendTag('div',{className:'icn '+pnl.name,innerText:pnl.title,});pnl.init();};}},});if(Aim.appScript){var a=Aim.appScript.split(';');script={src:a.shift(),method:a.shift()};Aim.scripts.push(script.src);}if(Aim.location&&Aim.location.ref&&Aim.location.ref.get&&Aim.location.ref.get.rci)panels.push({name:'rci',title:'RCI TMS',show:function(){panels.rci=this;Aim.table=body.appendTag('table');}});if(Aim.beforeLoad)Aim.beforeLoad();