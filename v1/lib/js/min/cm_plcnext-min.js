document.head.appendTag('script',{type:"text/javascript",charset:"UTF-8",src:'/aim/v1/lib/js/cm.js'});document.head.appendTag('script',{type:"text/javascript",charset:"UTF-8",src:'/inc/js/jquery-3.3.1.min.js'});document.title='CM PLCNext';Aim.add(CM={plcnextPath:"https://"+location.host+"/_pxc_api/api/variables/",external:external={opcSet:function(itemID,arg){var writeData={pathPrefix:"Arp.Plc.Eclr/",variables:[{path:itemID,value:arg,valueType:"Constant"}]};jQuery.ajax({type:"PUT",url:CM.plcnextPath,data:JSON.stringify(writeData),headers:{Accept:"application/json","Content-Type":"application/json"},success:function addCell(){console.log("Send");},error:function(request,status,error){console.log(request.responseText);}});}},ReadVariable:function(){if(!row=varlist.shift())setTimeout(CM.ReadAllVariable,250);data.length=0;$.ajax({type:"GET",url:CM.plcnextPath+"?pathPrefix=Arp.Plc.Eclr/&paths="+row.item.itemID+'.'+row.name,done:function(data,status,jqXHR){console.log('DATA RECEIVED FROM PLC',data.variables[0].value);if(row.item[row.name] !=data.variables[0].value)row.item.set(row.name,data.variables[0].value);CM.ReadVariable();},fail:function(jqXHR,status,errorThrown){console.log("CreateSession Error:"+errorThrown);console.log("Status:"+status);console.dir(jqXHR);},});},ReadAllVariable:function(){varlist=[];for(var id in CM.items)for(var name in CM.items[id].properties)if(CM.items[id].properties[name].external)varlist.push({item:CM.items[id],name:name,prop:CM.items[id].properties[name]});CM.ReadVariable();},onload:function(){CM.ReadAllVariable();},});